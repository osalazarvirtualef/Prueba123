ng.module("smart-table").controller("stTableController",["$scope","$parse","$filter","$attrs",function(t,n,r,i){function m(e){return e?[].concat(e):[]}function g(){c=m(a(t)),p===!0&&d.pipe()}var s=i.stTable,o=n(s),u=o.assign,a,f=r("orderBy"),l=r("filter"),c=m(o(t)),h={sort:{},search:{},pagination:{start:0}},p=!0,d=this,v;i.stSafeSrc&&(a=n(i.stSafeSrc),t.$watch(function(){var e=a(t);return e?e.length:0},function(e,t){e!==c.length&&g()}),t.$watch(function(){return a(t)},function(e,t){e!==t&&g()})),this.sortBy=function(t,n){return h.sort.predicate=t,h.sort.reverse=n===!0,ng.isFunction(t)?h.sort.functionName=t.name:delete h.sort.functionName,h.pagination.start=0,this.pipe()},this.search=function(t,n){var r=h.search.predicateObject||{},i=n?n:"$";return t=ng.isString(t)?t.trim():t,r[i]=t,t||delete r[i],h.search.predicateObject=r,h.pagination.start=0,this.pipe()},this.pipe=function(){var n=h.pagination,r=h.search.predicateObject?l(c,h.search.predicateObject):c;h.sort.predicate&&(r=f(r,h.sort.predicate,h.sort.reverse)),n.number!==undefined&&(n.numberOfPages=r.length>0?Math.ceil(r.length/n.number):1,n.start=n.start>=r.length?(n.numberOfPages-1)*n.number:n.start,r=r.slice(n.start,n.start+parseInt(n.number))),u(t,r)},this.select=function(t,n){var r=c,i=r.indexOf(t);i!==-1&&(n==="single"?(t.isSelected=t.isSelected!==!0,v&&(v.isSelected=!1),v=t.isSelected===!0?t:undefined):r[i].isSelected=!r[i].isSelected)},this.slice=function(t,n){return h.pagination.start=t,h.pagination.number=n,this.pipe()},this.tableState=function(){return h},this.setFilterFunction=function(t){l=r(t)},this.setSortFunction=function(t){f=r(t)},this.preventPipeOnWatch=function(){p=!1}}]).directive("stTable",function(){return{restrict:"A",controller:"stTableController",link:function(e,t,n,r){n.stSetFilter&&r.setFilterFunction(n.stSetFilter),n.stSetSort&&r.setSortFunction(n.stSetSort)}}});