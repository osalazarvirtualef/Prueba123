/** 
* @version 1.4.11
* @license MIT
*/

!function(e,t){e.module("smart-table",[]).run(["$templateCache",function(e){e.put("template/smart-table/pagination.html",'<div class="pagination" ng-if="pages.length >= 2"><ul class="pagination"><li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}</a></li></ul></div>')}]),e.module("smart-table").controller("stTableController",["$scope","$parse","$filter","$attrs",function(n,r,i,s){function o(e){return e?[].concat(e):[]}function u(){v=o(a(n)),g===!0&&y.pipe()}var a,f,l=s.stTable,c=r(l),h=c.assign,p=i("orderBy"),d=i("filter"),v=o(c(n)),m={sort:{},search:{},pagination:{start:0}},g=!0,y=this;s.stSafeSrc&&(a=r(s.stSafeSrc),n.$watch(function(){var e=a(n);return e?e.length:0},function(e){e!==v.length&&u()}),n.$watch(function(){return a(n)},function(e,t){e!==t&&u()})),this.sortBy=function(t,n){return m.sort.predicate=t,m.sort.reverse=n===!0,e.isFunction(t)?m.sort.functionName=t.name:delete m.sort.functionName,m.pagination.start=0,this.pipe()},this.search=function(t,n){var r=m.search.predicateObject||{},i=n?n:"$";return t=e.isString(t)?t.trim():t,r[i]=t,t||delete r[i],m.search.predicateObject=r,m.pagination.start=0,this.pipe()},this.pipe=function(){var e=m.pagination,r=m.search.predicateObject?d(v,m.search.predicateObject):v;m.sort.predicate&&(r=p(r,m.sort.predicate,m.sort.reverse)),e.number!==t&&(e.numberOfPages=r.length>0?Math.ceil(r.length/e.number):1,e.start=e.start>=r.length?(e.numberOfPages-1)*e.number:e.start,r=r.slice(e.start,e.start+parseInt(e.number))),h(n,r)},this.select=function(e,n){var r=v,i=r.indexOf(e);-1!==i&&("single"===n?(e.isSelected=e.isSelected!==!0,f&&(f.isSelected=!1),f=e.isSelected===!0?e:t):r[i].isSelected=!r[i].isSelected)},this.slice=function(e,t){return m.pagination.start=e,m.pagination.number=t,this.pipe()},this.tableState=function(){return m},this.setFilterFunction=function(e){d=i(e)},this.setSortFunction=function(e){p=i(e)},this.preventPipeOnWatch=function(){g=!1}}]).directive("stTable",function(){return{restrict:"A",controller:"stTableController",link:function(e,t,n,r){n.stSetFilter&&r.setFilterFunction(n.stSetFilter),n.stSetSort&&r.setSortFunction(n.stSetSort)}}}),e.module("smart-table").directive("stSearch",["$timeout",function(e){return{require:"^stTable",scope:{predicate:"=?stSearch"},link:function(t,n,r,i){var s=i,o=null,u=r.stDelay||400;t.$watch("predicate",function(e,t){e!==t&&(i.tableState().search={},s.search(n[0].value||"",e))}),t.$watch(function(){return i.tableState().search},function(e){var r=t.predicate||"$";e.predicateObject&&e.predicateObject[r]!==n[0].value&&(n[0].value=e.predicateObject[r]||"")},!0),n.bind("input",function(n){n=n.originalEvent||n,null!==o&&e.cancel(o),o=e(function(){s.search(n.target.value,t.predicate||""),o=null},u)})}}}]),e.module("smart-table").directive("stSelectRow",function(){return{restrict:"A",require:"^stTable",scope:{row:"=stSelectRow"},link:function(e,t,n,r){var i=n.stSelectMode||"single";t.bind("click",function(){e.$apply(function(){r.select(e.row,i)})}),e.$watch("row.isSelected",function(e){e===!0?t.addClass("st-selected"):t.removeClass("st-selected")})}}}),e.module("smart-table").directive("stSort",["$parse",function(n){return{restrict:"A",require:"^stTable",link:function(r,i,s,o){function u(){h++,l=e.isFunction(c(r))?c(r):s.stSort,h%3===0&&s.stSkipNatural===t?(h=0,o.tableState().sort={},o.tableState().pagination.start=0,o.pipe()):o.sortBy(l,h%2===0)}var f,l=s.stSort,c=n(l),h=0,p=s.stClassAscent||"st-sort-ascent",d=s.stClassDescent||"st-sort-descent",v=[p,d];s.stSortDefault&&(f=r.$eval(s.stSortDefault)!==t?r.$eval(s.stSortDefault):s.stSortDefault),i.bind("click",function(){l&&r.$apply(u)}),f&&(h="reverse"===s.stSortDefault?1:0,u()),r.$watch(function(){return o.tableState().sort},function(e){e.predicate!==l?(h=0,i.removeClass(p).removeClass(d)):(h=e.reverse===!0?2:1,i.removeClass(v[h%2]).addClass(v[h-1]))},!0)}}}]),e.module("smart-table").directive("stPagination",function(){return{restrict:"EA",require:"^stTable",scope:{stItemsByPage:"=?",stDisplayedPages:"=?",stPageChange:"&"},templateUrl:function(e,t){return t.stTemplate?t.stTemplate:"template/smart-table/pagination.html"},link:function(e,t,n,r){function i(){var t,n,i=r.tableState().pagination,s=1,o=e.currentPage;for(e.currentPage=Math.floor(i.start/i.number)+1,s=Math.max(s,e.currentPage-Math.abs(Math.floor(e.stDisplayedPages/2))),t=s+e.stDisplayedPages,t>i.numberOfPages&&(t=i.numberOfPages+1,s=Math.max(1,t-e.stDisplayedPages)),e.pages=[],e.numPages=i.numberOfPages,n=s;t>n;n++)e.pages.push(n);o!==e.currentPage&&e.stPageChange({newPage:e.currentPage})}e.stItemsByPage=e.stItemsByPage?+e.stItemsByPage:10,e.stDisplayedPages=e.stDisplayedPages?+e.stDisplayedPages:5,e.currentPage=1,e.pages=[],e.$watch(function(){return r.tableState().pagination},i,!0),e.$watch("stItemsByPage",function(t,n){t!==n&&e.selectPage(1)}),e.$watch("stDisplayedPages",i),e.selectPage=function(t){t>0&&t<=e.numPages&&r.slice((t-1)*e.stItemsByPage,e.stItemsByPage)},r.tableState().pagination.number||r.slice(0,e.stItemsByPage)}}}),e.module("smart-table").directive("stPipe",function(){return{require:"stTable",scope:{stPipe:"="},link:{pre:function(t,n,r,i){e.isFunction(t.stPipe)&&(i.preventPipeOnWatch(),i.pipe=function(){return t.stPipe(i.tableState(),i)})},post:function(e,t,n,r){r.pipe()}}}})}(angular);