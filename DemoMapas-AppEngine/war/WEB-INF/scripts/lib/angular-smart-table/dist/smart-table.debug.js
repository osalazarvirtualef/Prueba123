/** 
* @version 1.4.11
* @license MIT
*/

(function(e,t){e.module("smart-table",[]).run(["$templateCache",function(e){e.put("template/smart-table/pagination.html",'<div class="pagination" ng-if="pages.length >= 2"><ul class="pagination"><li ng-repeat="page in pages" ng-class="{active: page==currentPage}"><a ng-click="selectPage(page)">{{page}}</a></li></ul></div>')}]),e.module("smart-table").controller("stTableController",["$scope","$parse","$filter","$attrs",function(r,i,s,o){function y(e){return e?[].concat(e):[]}function b(){p=y(l(r)),v===!0&&m.pipe()}var u=o.stTable,a=i(u),f=a.assign,l,c=s("orderBy"),h=s("filter"),p=y(a(r)),d={sort:{},search:{},pagination:{start:0}},v=!0,m=this,g;o.stSafeSrc&&(l=i(o.stSafeSrc),r.$watch(function(){var e=l(r);return e?e.length:0},function(e,t){e!==p.length&&b()}),r.$watch(function(){return l(r)},function(e,t){e!==t&&b()})),this.sortBy=function(n,r){return d.sort.predicate=n,d.sort.reverse=r===!0,e.isFunction(n)?d.sort.functionName=n.name:delete d.sort.functionName,d.pagination.start=0,this.pipe()},this.search=function(n,r){var i=d.search.predicateObject||{},s=r?r:"$";return n=e.isString(n)?n.trim():n,i[s]=n,n||delete i[s],d.search.predicateObject=i,d.pagination.start=0,this.pipe()},this.pipe=function(){var n=d.pagination,i=d.search.predicateObject?h(p,d.search.predicateObject):p;d.sort.predicate&&(i=c(i,d.sort.predicate,d.sort.reverse)),n.number!==t&&(n.numberOfPages=i.length>0?Math.ceil(i.length/n.number):1,n.start=n.start>=i.length?(n.numberOfPages-1)*n.number:n.start,i=i.slice(n.start,n.start+parseInt(n.number))),f(r,i)},this.select=function(n,r){var i=p,s=i.indexOf(n);s!==-1&&(r==="single"?(n.isSelected=n.isSelected!==!0,g&&(g.isSelected=!1),g=n.isSelected===!0?n:t):i[s].isSelected=!i[s].isSelected)},this.slice=function(t,n){return d.pagination.start=t,d.pagination.number=n,this.pipe()},this.tableState=function(){return d},this.setFilterFunction=function(t){h=s(t)},this.setSortFunction=function(t){c=s(t)},this.preventPipeOnWatch=function(){v=!1}}]).directive("stTable",function(){return{restrict:"A",controller:"stTableController",link:function(e,t,n,r){n.stSetFilter&&r.setFilterFunction(n.stSetFilter),n.stSetSort&&r.setSortFunction(n.stSetSort)}}}),e.module("smart-table").directive("stSearch",["$timeout",function(e){return{require:"^stTable",scope:{predicate:"=?stSearch"},link:function(t,n,r,i){var s=i,o=null,u=r.stDelay||400;t.$watch("predicate",function(e,t){e!==t&&(i.tableState().search={},s.search(n[0].value||"",e))}),t.$watch(function(){return i.tableState().search},function(e,r){var i=t.predicate||"$";e.predicateObject&&e.predicateObject[i]!==n[0].value&&(n[0].value=e.predicateObject[i]||"")},!0),n.bind("input",function(n){n=n.originalEvent||n,o!==null&&e.cancel(o),o=e(function(){s.search(n.target.value,t.predicate||""),o=null},u)})}}}]),e.module("smart-table").directive("stSelectRow",function(){return{restrict:"A",require:"^stTable",scope:{row:"=stSelectRow"},link:function(e,t,n,r){var i=n.stSelectMode||"single";t.bind("click",function(){e.$apply(function(){r.select(e.row,i)})}),e.$watch("row.isSelected",function(e){e===!0?t.addClass("st-selected"):t.removeClass("st-selected")})}}}),e.module("smart-table").directive("stSort",["$parse",function(n){return{restrict:"A",require:"^stTable",link:function(r,i,s,o){function d(){f++,u=e.isFunction(a(r))?a(r):s.stSort,f%3===0&&s.stSkipNatural===t?(f=0,o.tableState().sort={},o.tableState().pagination.start=0,o.pipe()):o.sortBy(u,f%2===0)}var u=s.stSort,a=n(u),f=0,l=s.stClassAscent||"st-sort-ascent",c=s.stClassDescent||"st-sort-descent",h=[l,c],p;s.stSortDefault&&(p=r.$eval(s.stSortDefault)!==t?r.$eval(s.stSortDefault):s.stSortDefault),i.bind("click",function(){u&&r.$apply(d)}),p&&(f=s.stSortDefault==="reverse"?1:0,d()),r.$watch(function(){return o.tableState().sort},function(e){e.predicate!==u?(f=0,i.removeClass(l).removeClass(c)):(f=e.reverse===!0?2:1,i.removeClass(h[f%2]).addClass(h[f-1]))},!0)}}}]),e.module("smart-table").directive("stPagination",function(){return{restrict:"EA",require:"^stTable",scope:{stItemsByPage:"=?",stDisplayedPages:"=?",stPageChange:"&"},templateUrl:function(e,t){return t.stTemplate?t.stTemplate:"template/smart-table/pagination.html"},link:function(e,t,n,r){function i(){var t=r.tableState().pagination,n=1,i,s,o=e.currentPage;e.currentPage=Math.floor(t.start/t.number)+1,n=Math.max(n,e.currentPage-Math.abs(Math.floor(e.stDisplayedPages/2))),i=n+e.stDisplayedPages,i>t.numberOfPages&&(i=t.numberOfPages+1,n=Math.max(1,i-e.stDisplayedPages)),e.pages=[],e.numPages=t.numberOfPages;for(s=n;s<i;s++)e.pages.push(s);o!==e.currentPage&&e.stPageChange({newPage:e.currentPage})}e.stItemsByPage=e.stItemsByPage?+e.stItemsByPage:10,e.stDisplayedPages=e.stDisplayedPages?+e.stDisplayedPages:5,e.currentPage=1,e.pages=[],e.$watch(function(){return r.tableState().pagination},i,!0),e.$watch("stItemsByPage",function(t,n){t!==n&&e.selectPage(1)}),e.$watch("stDisplayedPages",i),e.selectPage=function(t){t>0&&t<=e.numPages&&r.slice((t-1)*e.stItemsByPage,e.stItemsByPage)},r.tableState().pagination.number||r.slice(0,e.stItemsByPage)}}}),e.module("smart-table").directive("stPipe",function(){return{require:"stTable",scope:{stPipe:"="},link:{pre:function(t,n,r,i){e.isFunction(t.stPipe)&&(i.preventPipeOnWatch(),i.pipe=function(){return t.stPipe(i.tableState(),i)})},post:function(e,t,n,r){r.pipe()}}}})})(angular);